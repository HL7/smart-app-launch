resourceType: StructureDefinition
id: patient-access-brands-bundle

url: >-
  http://hl7.org/fhir/smart-app-launch/StructureDefinition/patient-access-brands-bundle

name: PatientAccessBrandBundle
title: Patient Access Brand Bundle Profile
status: active
date: '2023-03-19'

description: |
   JSON FHIR Bundle (type: `collection`) of Endpoint and related resources is hosted at a stable, publicly available, publicly disclosed location. Bundle Entries include:
   * [Patient Access Endpoint Profile](StructureDefinition-patient-access-endpoint.html) resources.
   * [Patient Access Brand (Organization)](StructureDefinition-PatientAccessBrand.html) resources. **Vendors SHALL publish at least a "primary brand" for each endpoint and SHOULD support the publication of a more detailed Brand hierarchy.TODO: does this need an invariant?**
  
   Brand Bundles SHALL populate `Bundle.meta.lastUpdated` to advertise the timestamp of the last change to the contents. In addition, Brand Bundles SHOULD populate `Bundle.entry.resource.meta.lastUpdated` with a more detailed timestamp if the system tracks updates per Resource.

fhirVersion: 4.0.1

kind: resource
abstract: false
type: Bundle
baseDefinition: 'http://hl7.org/fhir/StructureDefinition/Bundle'
derivation: constraint


differential:
  element:
    - id: Bundle
      path: Bundle
      short: Patient Access Brands Bundle
      definition: >-
        FHIR Bundle (type: collection) of Endpoints and related resources hosted at a stable, publicly available, publicly disclosed location
        Endpoint associated with a Patient Access Brand (Organization)
    - id: Bundle.meta
      path: Bundle.meta
      mustSupport: true
    - id: Bundle.meta.lastUpdated
      path: Bundle.meta.lastUpdated
      min: 1
      mustSupport: true


    # - id: Bundle.id
    #   path: Bundle.id
    #   min: 1
    #   mustSupport: true

    - id: Bundle.type
      path: Bundle.type
      type:
        - code: code
      fixedCode: collection
      mustSupport: true

    # - id: Bundle.timestamp
    #   path: Bundle.timestamp
    #   min: 1
    #   mustSupport: true
    # - id: Bundle.total
    #   path: Bundle.total
    #   min: 0
    #   max: '0'
    #   mustSupport: false
    #   comment: This element is constrained to min = 0 because of the invariant `bdl-1`
    - id: Bundle.entry
      path: Bundle.entry
      slicing:
        discriminator:
          - type: type
            path: resource
        rules: open
      mustSupport: true
    # - id: Bundle.entry.search
    #   path: Bundle.entry.search
    #   min: 0
    #   max: '0'
    #   mustSupport: false
    #   comment: This element is constrained to min = 0 because of the invariant `bdl-2`
    # - id: Bundle.entry.request
    #   path: Bundle.entry.request
    #   min: 0
    #   max: '0'
    #   mustSupport: false
    #   comment: This element is constrained to min = 0 because of the invariant `bdl-3`
    # - id: Bundle.entry.response
    #   path: Bundle.entry.response
    #   min: 0
    #   max: '0'
    #   mustSupport: false
    #   comment: This element is constrained to min = 0 because of the invariant `bdl-4`
    - id: 'Bundle.entry:PatientAccessEndpoint'
      path: Bundle.entry
      sliceName: PatientAccessEndpoint
      mustSupport: true
    - id: 'Bundle.entry:PatientAccessEndpoint.resource'
      path: Bundle.entry.resource
      type:
        - code: Endpoint
          profile:
            - >-
              http://hl7.org/fhir/smart-app-launch/StructureDefinition/patient-access-endpoint
      mustSupport: true
    - id: 'Bundle.entry:PatientAccessBrand'
      path: Bundle.entry
      sliceName: PatientAccessBrand
      mustSupport: true
    - id: 'Bundle.entry:PatientAccessBrand.resource'
      path: Bundle.entry.resource
      type:
        - code: Organization
          profile:
            - >-
              http://hl7.org/fhir/smart-app-launch/StructureDefinition/patient-access-brand
      mustSupport: true